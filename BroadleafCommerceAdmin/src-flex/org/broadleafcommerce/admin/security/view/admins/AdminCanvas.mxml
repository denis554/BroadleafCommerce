<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:admins="org.broadleafcommerce.admin.security.view.admins.*"
	xmlns:components="org.broadleafcommerce.util.components.*"
	width="800" height="800"
	creationComplete="creationComplete();">
	<mx:Script>
		<![CDATA[
			import org.broadleafcommerce.admin.security.control.events.SaveAdminUserEvent;
			import org.broadleafcommerce.admin.core.vo.security.AdminUser;
			import org.broadleafcommerce.admin.security.control.events.FindAllRolesEvent;
			import org.broadleafcommerce.admin.security.model.SecurityModel;
			import org.broadleafcommerce.admin.security.control.events.FindAllAdminUsersEvent;
			import org.broadleafcommerce.admin.security.model.SecurityModelLocator;
			import mx.collections.ArrayCollection;
			
			private function creationComplete():void{
				var faae:FindAllAdminUsersEvent = new FindAllAdminUsersEvent();
				faae.dispatch();
				
				var fare:FindAllRolesEvent = new FindAllRolesEvent();
				fare.dispatch();
			}
			
			private function handleSaveClick(event:Event):void{
				var adminUser:AdminUser = new AdminUser();
				adminUser.id = null;
				adminUser.name = this.txtName.text;
				adminUser.login = this.txtLogin.text;
				adminUser.email = this.txtEmail.text;
				adminUser.password = this.txtPassword.text;
				var roles:ArrayCollection = new ArrayCollection(this.roleList.selectedItems);
				adminUser.allRoles = roles;
				
				var saveAdmin:SaveAdminUserEvent = new SaveAdminUserEvent(adminUser);
				saveAdmin.dispatch();
			}
			
			private function handleNewRoleClick(event:Event):void{

			}

			private function handleViewEditButtonClick(event:Event):void{
				
			}
			
			private function handleRemoveButtonClick(event:Event):void{
				//var deletePermission:DeleteAdminPermissionEvent = new DeleteAdminPermissionEvent(this.permissionDataGrid.selectedItem as AdminPermission);
				//deletePermission.dispatch();
			}
		]]>
	</mx:Script>
	
	<mx:VBox width="100%" height="100%">
	    <mx:TabNavigator id="tnAdminCanvas"  width="100%" height="100%" paddingLeft="20" paddingBottom="20" paddingTop="20" paddingRight="20">
	
	        <mx:VBox label="Search">
	        	<admins:AdminSimpleSearchGrid />
	        	<mx:HBox width="100%">
					<admins:AdminUsersDataGrid
						id="adminUsersDataGrid"
						width="90%" 
						height="100%" 
						doubleClickEnabled="true" />
					<mx:VBox width="10%">
						<mx:Button id="addButton" label="Add"/>
						<mx:Button id="viewEditButton" label="View/Edit" click="handleViewEditButtonClick(event)" />
						<mx:Button id="removeButton" label="Remove" click="handleRemoveButtonClick(event)"/>
					</mx:VBox>	        		
	        	</mx:HBox>
	        </mx:VBox>
	
	        <mx:VBox label="Administrator Details">
	            <mx:VBox width="100%">
	            	<mx:FormHeading label="New Administrator"/>	            	
	            	<mx:HBox width="50%">
	                    <mx:Form>
	                        <mx:FormItem label="Name">
	                            <mx:TextInput id="txtName"/>
	                        </mx:FormItem>
	                        <mx:FormItem label="Login">
	                            <mx:TextInput id="txtLogin"/>
	                        </mx:FormItem>
	                        <mx:FormItem label="Password">
	                            <mx:TextInput id="txtPassword" displayAsPassword="true"/>
	                        </mx:FormItem>
	                        <mx:FormItem label="Confirm Password">
	                            <mx:TextInput  id="txtPasswordConfirm" displayAsPassword="true"/>
	                        </mx:FormItem>
	                        <mx:FormItem label="Email">
	                            <mx:TextInput id="txtEmail"/>
	                        </mx:FormItem>
	                    </mx:Form>

		                <mx:VBox height="100%">
			                <mx:Label text="Roles"/>
				            <components:CheckBoxList id="roleList" allowMultipleSelection="true" dataProvider="{SecurityModelLocator.getInstance().adminRoles}" labelField="name" 
			       				width="400">
			                </components:CheckBoxList>
			               	<mx:Button
		                        label="Create New Role" 
		                        click="handleNewRoleClick(event)"/>
			            </mx:VBox>
		            
	            	</mx:HBox>
		        </mx:VBox>
		        
    	     	<mx:Button label="Save" click="handleSaveClick(event)"/>
	        </mx:VBox>
	        
	    </mx:TabNavigator>

	</mx:VBox> 
</mx:Canvas>
