<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" 
	width="600" height="500" xmlns:view="org.broadleafcommerce.admin.view.*"
	backgroundColor="#ffffff"
	currentState="{STATE_WHAT}" xmlns:wizard="org.broadleafcommerce.admin.view.components.wizard.*"
	title="New Offer Wizard"
	creationComplete="handleCreationComplete()"
	showCloseButton="true"
	modalTransparencyBlur="0"
	modalTransparencyColor="#FFFFFF"
	modalTransparency="0"
	close="PopUpManager.removePopUp(this)"
	xmlns:offerWizard="org.broadleafcommerce.admin.view.offer.offerWizard.*" xmlns:offerWizardB="org.broadleafcommerce.admin.view.components.offerWizardB.*">
	<mx:Metadata>
		[Event(name="wizardCancelEvent", type="org.broadleafcommerce.admin.view.events.WizardEvent")]
		[Event(name="wizardDoneEvent", type="org.broadleafcommerce.admin.view.events.WizardEvent")]
	</mx:Metadata>
	
<mx:Script>
	<![CDATA[
		import org.broadleafcommerce.admin.model.data.remote.Offer;
		import mx.controls.Alert;
		import mx.collections.ArrayCollection;
		import org.broadleafcommerce.admin.control.events.AddUpdateOfferEvent;
		import org.broadleafcommerce.admin.control.commands.offers.AddUpdateOfferCommand;
		import org.broadleafcommerce.admin.model.AppModelLocator;
		import org.broadleafcommerce.admin.view.BlcMenu;
		import mx.managers.PopUpManager;
		import org.broadleafcommerce.admin.view.events.WizardEvent;
		[Bindable]
		private static var STATE_WHO:String = "state_who";
		[Bindable]
		private static var STATE_WHAT:String = "state_what";
		[Bindable]
		private static var STATE_HOW:String = "state_how";
		
		[Bindable]
		private var currentOffer:Offer = AppModelLocator.getInstance().offerModel.currentOffer;
		
		[Bindable]
		private var editOffer:Offer = new Offer();

			private function handleCreationComplete():void {
                // Center the TitleWindow container 
                // over the control that created it.
                PopUpManager.centerPopUp(this);
            }
            


		private function handleWizardNextEvent(event:WizardEvent):void{
			switch(currentState){
				case STATE_WHAT:
					currentState = STATE_HOW;
					break;
				case STATE_HOW:
					currentState = STATE_WHO;
					break;
				case STATE_WHO:
					dispatchEvent(new WizardEvent(WizardEvent.WIZARD_DONE_EVENT));
					updateOffer();
	                PopUpManager.removePopUp(this);
					currentState = STATE_WHAT;
					break;
			}
		}

		private function handleWizardPreviousEvent(event:WizardEvent):void{
			switch(currentState){
				case STATE_WHAT:
					dispatchEvent(new WizardEvent(WizardEvent.WIZARD_CANCEL_EVENT));
	                PopUpManager.removePopUp(this);
					break;
				case STATE_HOW:
					currentState = STATE_WHAT;
					break;
				case STATE_WHO:
					currentState = STATE_HOW;
					break;
			}
			
		}

		private function updateOffer():void
		{
			editOffer.uses = currentOffer.uses;
			editOffer.id = currentOffer.id;			
			var auoe:AddUpdateOfferEvent = new AddUpdateOfferEvent(editOffer);
			auoe.dispatch();
			
		}
		
	]]>
</mx:Script>

<mx:Binding destination="editOffer.name" source="whatCanvas.offerNameText.text" />
<mx:Binding destination="editOffer.description" source="whatCanvas.offerDescriptionText.text" />
<mx:Binding destination="editOffer.startDate" source="whatCanvas.offerDateFrom.selectedDate" />
<mx:Binding destination="editOffer.endDate" source="whatCanvas.offerDateTo.selectedDate" />
<mx:Binding destination="editOffer.typeString" source="whatCanvas.offerType.selectedItem.valueOf()" />
<mx:Binding destination="editOffer.applyDiscountToSalePrice" source="whatCanvas.saleRadio.selected" />
<mx:Binding destination="editOffer.valueNumber" source="Number(whatCanvas.discountValue.text)" />
<mx:Binding destination="editOffer.discountTypeString" source="whatCanvas.discountType.selectedItem.toString()" />

<mx:Binding destination="editOffer.priority" source="Number(howCanvas.offerPriorityText.text)" />
<mx:Binding destination="editOffer.applyDiscountToMarkedItems" source="howCanvas.stackableCheckbox.selected" />
<mx:Binding destination="editOffer.combinableWithOtherOffers" source="howCanvas.combinableCheckbox.selected" />
<mx:Binding destination="editOffer.maxUses" source="Number(howCanvas.usesText.text) " />  
<mx:Binding destination="editOffer.appliesToOrderRules" source="howCanvas.appliesOrderText.text" />  

<mx:Binding destination="editOffer.appliesToCustomerRules" source="whoCanvas.appliesCustomerText.text" />  
<mx:Binding destination="editOffer.deliveryTypeString" source="whoCanvas.customersRadioGroup.selectedValue.toString()" />


<mx:Binding source="{currentOffer.name}" destination="whatCanvas.offerNameText.text" />
<mx:Binding source="{currentOffer.description}" destination="whatCanvas.offerDescriptionText.text" />
<mx:Binding source="{currentOffer.startDate}" destination="whatCanvas.offerDateFrom.selectedDate" />
<mx:Binding source="{currentOffer.endDate}" destination="whatCanvas.offerDateTo.selectedDate" />
<mx:Binding source="{currentOffer.typeString}" destination="whatCanvas.offerType.selectedItem" />
<mx:Binding source="{currentOffer.applyDiscountToSalePrice}" destination="whatCanvas.saleRadio.selected" />
<mx:Binding source="{!currentOffer.applyDiscountToSalePrice}" destination="whatCanvas.retailRadio.selected" />
<mx:Binding source="{currentOffer.valueNumber.toString()}" destination="whatCanvas.discountValue.text" />
<mx:Binding source="{currentOffer.discountTypeString}" destination="whatCanvas.discountType.selectedItem" />

<mx:Binding source="{currentOffer.priority.toString()}" destination="howCanvas.offerPriorityText.text" />
<mx:Binding source="{currentOffer.applyDiscountToMarkedItems}" destination="howCanvas.stackableCheckbox.selected" />
<mx:Binding source="{currentOffer.combinableWithOtherOffers}" destination="howCanvas.combinableCheckbox.selected" />
<mx:Binding source="{currentOffer.maxUses.toString()}" destination="howCanvas.usesText.text" />  
<mx:Binding source="{currentOffer.appliesToOrderRules}" destination="howCanvas.appliesOrderText.text" />  

<mx:Binding source="{currentOffer.appliesToCustomerRules}" destination="whoCanvas.appliesCustomerText.text" />  
<mx:Binding source="{currentOffer.deliveryTypeString}" destination="whoCanvas.customersRadioGroup.selectedValue" />


	<mx:HBox >
		<mx:Label id="whatLabel" text="Offer" click="{currentState=STATE_WHAT}" />
		<mx:Label text="->" />
		<mx:Label id="howLabel" text="Detail" click="{currentState=STATE_HOW}"/>
		<mx:Label text="->" />
		<mx:Label id="whoLabel" text="Customer" click="{currentState=STATE_WHO}"/>
	</mx:HBox>
	<mx:Canvas width="100%" height="100%" backgroundAlpha="1.0" id="canvas1" horizontalScrollPolicy="off" verticalScrollPolicy="off">
		
	<offerWizard:NameCanvas id="whatCanvas" height="100%" width="100%" visible="false" wizardNextEvent="handleWizardNextEvent(event)" wizardPreviousEvent="handleWizardPreviousEvent(event)" />	
	<offerWizard:DetailCanvas id="howCanvas" height="100%" width="100%" visible="false" wizardNextEvent="handleWizardNextEvent(event)" wizardPreviousEvent="handleWizardPreviousEvent(event)"/>
	<offerWizard:CustomerCanvas id="whoCanvas" height="100%" width="100%" visible="false" wizardNextEvent="handleWizardNextEvent(event)" wizardPreviousEvent="handleWizardPreviousEvent(event)"/>
	</mx:Canvas>
	
	<mx:states>
		<mx:State name="{STATE_WHAT}" >
			<mx:SetProperty target="{whatCanvas}" name="visible" value="true" />
			<mx:SetProperty target="{whatCanvas}" name="height" value="429"/>
			<mx:SetProperty target="{whatCanvas}" name="y" value="23"/>
			<mx:SetStyle target="{whatLabel}" name="fontWeight" value="bold" />
		</mx:State>
		<mx:State name="{STATE_HOW}" >
			<mx:SetProperty target="{howCanvas}" name="visible" value="true" />
			<mx:SetStyle target="{howLabel}" name="fontWeight" value="bold" />
		</mx:State>
		<mx:State name="{STATE_WHO}" >
			<mx:SetProperty target="{whoCanvas}" name="visible" value="true" />
			<mx:SetStyle target="{whoLabel}" name="fontWeight" value="bold" />
		</mx:State>
	</mx:states>
</mx:TitleWindow>
