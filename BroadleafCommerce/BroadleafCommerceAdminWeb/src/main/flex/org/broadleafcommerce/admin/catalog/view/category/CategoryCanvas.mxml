<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas
	xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:category="org.broadleafcommerce.admin.view.catalog.category.*"
	currentState="none"
	creationComplete="handleCreationComplete()"
	xmlns:category1="org.broadleafcommerce.admin.catalog.view.category.*"
	xmlns:components="org.broadleafcommerce.admin.catalog.view.category.components.*"
	xmlns:components1="org.broadleafcommerce.admin.catalog.view.components.*">
	<mx:Script>
		<![CDATA[
			import mx.controls.List;
			import mx.utils.ObjectUtil;
			import org.broadleafcommerce.admin.catalog.vo.Media;
			import org.broadleafcommerce.admin.catalog.control.events.category.EditCategoryMediaEvent;
			import org.broadleafcommerce.admin.catalog.control.events.category.SaveCategoryEvent;
			import org.broadleafcommerce.admin.catalog.control.events.category.AddCategoryMediaEvent;
			import org.broadleafcommerce.admin.catalog.model.CatalogModelLocator;
			import org.broadleafcommerce.admin.catalog.model.CategoryModel;
			import org.broadleafcommerce.admin.catalog.control.events.category.NewCategoryEvent;
			import org.broadleafcommerce.admin.catalog.control.events.category.EditCategoryEvent;
			import org.broadleafcommerce.admin.catalog.vo.category.Category;
			import org.broadleafcommerce.admin.core.model.AppModelLocator;
			import mx.events.ListEvent;

			[Bindable]
			private var categoryModel:CategoryModel = CatalogModelLocator.getInstance().categoryModel;

			private function handleCreationComplete():void{

			}

			private function handleAddClick(event:Event):void{
				var acme:AddCategoryMediaEvent = new AddCategoryMediaEvent();
				acme.dispatch();
			}
			
			private function handleEditClick(event:Event):void{
				var media:Media = Media(categoryMediaCanvas.mediaDataGrid.selectedItem);
				var ecme:EditCategoryMediaEvent = new EditCategoryMediaEvent(Media(ObjectUtil.copy(media)));
				ecme.dispatch();
			}
			
			private function handleSaveClick(event:Event):void{
				var newMedia:Media = Media(List(MediaCanvas(event.currentTarget).mediaDataGrid).selectedItem);
				
				categoryModel.currentCategory.categoryMedia[newMedia.key] = newMedia;
				var sce:SaveCategoryEvent = new SaveCategoryEvent(categoryModel.currentCategory);
				sce.dispatch();
			}
			
			private function handleDeleteClick(event:Event):void{
				var deleteMedia:Media = Media(List(MediaCanvas(event.currentTarget).mediaDataGrid).selectedItem);;
				delete categoryModel.currentCategory.categoryMedia[deleteMedia.key];
				var sce:SaveCategoryEvent = new SaveCategoryEvent(categoryModel.currentCategory);
				sce.dispatch();				
			}

		]]>
	</mx:Script>

	<mx:Binding source="categoryModel.viewState"
					   destination="this.currentState" />

	<mx:Binding source="categoryModel.categoryMedia"
	            destination="categoryMediaCanvas.dataProvider" />

	<components1:MediaCanvasViewHelper id="categoryMediaCanvasViewHelper" />

		<mx:HDividedBox width="100%" height="100%" >
			<category1:CategoryTreeCanvas id="viewCategoriesCanvas" width="300" height="100%" />
			<mx:TabNavigator id="categoryTabNavigator" width="100%" height="100%">
				<category1:CategoryEditFormCanvas id="editCategoryCanvas"  label="General" width="100%" height="100%" />
				<components1:MediaCanvas label="Media" id="categoryMediaCanvas"
					width="100%" height="100%"
					clickAdd="handleAddClick(event)"
					clickEdit="handleEditClick(event)"
					clickDelete="handleDeleteClick(event)"/>
				<category1:CategoryProductsCanvas id="productsCanvas" label="Products" width="100%" height="100%" />
				<category1:CategoryFeaturedProductsCanvas id="featuredProductsCanvas" label="Featured Products" width="100%" height="100%" />
			</mx:TabNavigator>
		</mx:HDividedBox>
	<mx:states>
		<mx:State name="{CategoryModel.STATE_NONE}">
			<mx:SetProperty target="{editCategoryCanvas}" name="visible" value="true" />
		</mx:State>
		<mx:State name="{CategoryModel.STATE_NEW}">
			<mx:SetProperty target="{editCategoryCanvas}" name="visible" value="true" />
		</mx:State>
		<mx:State name="{CategoryModel.STATE_EDIT}">
			<mx:SetProperty target="{editCategoryCanvas}" name="visible" value="true" />
		</mx:State>
	</mx:states>
</mx:Canvas>
