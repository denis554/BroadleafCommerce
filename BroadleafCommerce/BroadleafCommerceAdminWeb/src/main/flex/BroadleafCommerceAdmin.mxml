<?xml version="1.0" encoding="utf-8"?>
<!--
/*
 * Copyright 2008-2009 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
-->
<mx:Application 
	xmlns:mx="http://www.adobe.com/2006/mxml"
	 applicationComplete="initApp()"
	 layout="absolute"
	 xmlns:business="org.broadleafcommerce.admin.core.business.*"
	 xmlns:control="org.broadleafcommerce.admin.core.control.*"
	 xmlns:view="org.broadleafcommerce.admin.core.view.*"
	 xmlns:local="*"
	 currentState="app_anonymous_state">
	<mx:Script>
		<![CDATA[
			import org.broadleafcommerce.admin.core.vo.Money;
			import mx.controls.DataGrid;
			import org.broadleafcommerce.admin.core.model.AppModelLocator;
			import org.broadleafcommerce.admin.core.model.AuthenticationModel;
			import org.broadleafcommerce.admin.core.control.events.InitializeApplicationEvent;
			import com.adobe.cairngorm.control.CairngormEventDispatcher;

     		import mx.managers.HistoryManager;
			import mx.managers.DragManager;
			import mx.managers.CursorManager;
			public var __dm:DragManager;
			public var __cm:CursorManager;
			public var __hm:HistoryManager;
			public var __dg:DataGrid;
			public var __money:Money;

			[Bindable]
			private var authModel:AuthenticationModel = AppModelLocator.getInstance().authModel;

			private function initApp():void{
				AppModelLocator.getInstance().configModel.urlPrefix = Application.application.loaderInfo.url.substr(0,
			                                          	  Application.application.loaderInfo.url.lastIndexOf("/"))+"/";
				var iae:InitializeApplicationEvent = new InitializeApplicationEvent();
				CairngormEventDispatcher.getInstance().dispatchEvent(iae);
			}
		]]>
	</mx:Script>
	<mx:Style 
		source="/assets/styles/broadleafadmin.css" />
	<mx:Binding 
		source="authModel.authenticatedState"
	    destination="this.currentState" />
	<control:AdminController />
	<business:AdminServices />
	<view:LoginCanvas 
		id="loginCanvas" 
		width="100%" 
		height="100%" 
		visible="true" />
	<local:ApplicationCanvas 
		id="applicationCanvas" 
		width="100%" 
		height="100%" 
		visible="false" />
	<mx:states>
		<mx:State 
			name="{AuthenticationModel.STATE_APP_ANONYMOUS}" >
			<mx:SetProperty 
				target="{loginCanvas}" 
				name="visible" 
				value="true" />
			<mx:SetProperty 
				target="{applicationCanvas}" 
				name="visible" 
				value="false" />
		</mx:State>
		<mx:State 
			name="{AuthenticationModel.STATE_APP_AUTHENTICATED}" >
			<mx:SetProperty 
				target="{loginCanvas}" 
				name="visible" 
				value="false" />
			<mx:SetProperty 
				target="{applicationCanvas}" 
				name="visible" 
				value="true" />
		</mx:State>
	</mx:states>
</mx:Application>
